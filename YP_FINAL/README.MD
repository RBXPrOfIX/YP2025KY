# Документация к проекту Lyrics Insight

Проект представляет собой систему для получения текста песен, их семантического и эмоционального анализа. Состоит из трёх основных компонентов:

- **Сервер** на FastAPI в папке `server`
- **Клиент** на PyQt5 в папке `client`
- **Скрипт заполнения** базы случайными треками `populate_random.py`

Для удобства развёртывания весь стек упакован в Docker-контейнеры и управляется через `docker-compose`.

## 1. Создание виртуальной среды и установка зависимостей

Откройте PowerShell в корневой папке проекта и выполните команды:

```powershell
# Создать виртуальную среду
python -m venv .venv

# Активировать виртуальную среду
.\.venv\Scripts\Activate.ps1

# Установить зависимости для разработки (проект, генерация данных и вспомогательные скрипты)
pip install -r requirements.env.txt
```

> После этих шагов вы сможете запускать локальные скрипты (например, `populate_random.py`) без Docker.

## 2. Генерация ключа шифрования (ENC_KEY_B64)

Сервис использует AES-GCM для защиты данных. Вам потребуется сгенерировать случайный ключ в формате Base64.

В терминале VS Code (PowerShell) выполните:

```powershell
# Сгенерировать 32 байта и перевести в строку Base64
$bytes = New-Object Byte[] 32
(New-Object System.Security.Cryptography.RNGCryptoServiceProvider).GetBytes($bytes)
[Convert]::ToBase64String($bytes)
```

Скопируйте результат и добавьте в файл `.env` в корне проекта:

```dotenv
ENC_KEY_B64=<ваш_ключ_BASE64>
DATABASE_URL=sqlite:///./database.db
GENIUS_TOKEN=<ваш_Genius_API_токен>
LASTFM_API_KEY=<ваш_LastFM_API_ключ>
```

## Получение API-токенов

- **Genius**: зарегистрируйтесь и создайте приложение на официальном сайте [Genius API](https://genius.com/api-clients)
- **Last.fm**: получите API-ключ на странице [Last.fm API](https://www.last.fm/api/account/create)


## 3. Установка Docker Desktop

1. Скачайте и установите [Docker Desktop](https://www.docker.com/products/docker-desktop) для вашей ОС.
2. Запустите Docker Desktop и убедитесь, что служба работает (иконка в трее).

## 4. Сборка образов с помощью Docker Compose

В корневой папке проекта выполните:

```powershell
docker-compose build
```

Эта команда соберёт сервис `api` (FastAPI сервер).

## 5. Запуск и управление контейнерами

```powershell
# Запустить все сервисы в фоновом режиме
docker-compose up -d

# Просмотреть логи всех сервисов
docker-compose logs -f

# Остановить и удалить контейнеры, сети и тома
docker-compose down
```

> По умолчанию сервер будет доступен на `http://localhost:8000`.

## 6. Альтернативный запуск сервера без Docker

Если вы предпочитаете запустить сервер локально без контейнера, выполните в активной виртуальной среде:

```powershell
# Перейти в папку server
cd server

# Установить зависимости серверной части
pip install -r ../requirements_server.txt

# Запустить сервер через uvicorn
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

> Флаг `--reload` автоматически перезапускает сервер при изменении кода.

## 7. Запуск клиентского приложения

1. Убедитесь, что в файле `.env` прописан тот же `ENC_KEY_B64`, что и на сервере.
2. В PowerShell (в корне проекта) активируйте виртуальную среду и установите клиентские зависимости:

```powershell
# Активировать виртуальную среду (если ещё не активирована)
.\.venv\Scripts\Activate.ps1

# Установить зависимости клиента
pip install -r client/requirements.txt
```

3. Запустите приложение из папки `client`:

```powershell
# Перейти в папку client
cd client

# Запустить клиентское приложение
python main.py
```

> После запуска откроется окно PyQt5 с полем для ввода названия трека и исполнителя.
> Введите данные и нажмите «Найти текст» для получения лирики и списка похожих треков.

---

Теперь система полностью готова к работе: вы можете наполнять базу данными, запускать сервер и клиент любым удобным способом и использовать API для дальнейшей интеграции.
